document.addEventListener('DOMContentLoaded',()=>{const formatSelect=document.getElementById('format');const qualityWrapper=document.getElementById('quality-wrapper');const qualitySlider=document.getElementById('quality');formatSelect.addEventListener('change',()=>{const selectedFormat=formatSelect.value;if(selectedFormat==='jpeg'||selectedFormat==='webp'){qualityWrapper.classList.remove('hidden')}else{qualityWrapper.classList.add('hidden')}});document.getElementById('process-btn').addEventListener('click',()=>{const f=document.getElementById('file-input').files[0],t=formatSelect.value.toLowerCase(),d=document.getElementById('download-link');if(!f){alert("Please select an image.");return}const r=new FileReader();r.onload=e=>{const i=new Image();i.onload=()=>{const c=document.createElement('canvas');c.width=i.width;c.height=i.height;c.getContext('2d').drawImage(i,0,0);const m='image/'+t;const quality=parseFloat(qualitySlider.value);d.href=c.toDataURL(m,quality);d.download=`converted-${f.name.split('.').slice(0,-1).join('.')}.${t}`;d.classList.remove('hidden');showResetButton()};i.src=e.target.result};r.readAsDataURL(f)})});