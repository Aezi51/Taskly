document.addEventListener('DOMContentLoaded',()=>{document.getElementById('process-btn').addEventListener('click',async()=>{const f=document.getElementById('file-input').files[0],d=document.getElementById('download-link'),s=document.getElementById('status');if(!f){alert('Please select a PDF file.');return}try{s.textContent='Attempting compression...';d.classList.add('hidden');const{PDFDocument}=PDFLib;const existingPdfBytes=await f.arrayBuffer();const pdfDoc=await PDFDocument.load(existingPdfBytes,{updateMetadata:false});const pdfBytes=await pdfDoc.save();const originalSize=(f.size/1024).toFixed(2);const newSize=(pdfBytes.byteLength/1024).toFixed(2);const reduction=originalSize>0?((1-newSize/originalSize)*100).toFixed(1):0;s.textContent=`Rebuilt PDF. Original: ${originalSize} KB, New: ${newSize} KB (${reduction}% reduction).`;d.href=URL.createObjectURL(new Blob([pdfBytes],{type:'application/pdf'}));d.download=`compressed-${f.name}`;d.classList.remove('hidden');showResetButton();}catch(e){s.textContent=`Error: ${e.message}`}})});