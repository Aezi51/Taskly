document.addEventListener('DOMContentLoaded',async()=>{document.getElementById('process-btn').addEventListener('click',async()=>{const f=document.getElementById('file-input').files[0],t=document.getElementById('watermark-text').value,d=document.getElementById('download-link'),s=document.getElementById('status');if(!f||!t){alert('Please select a file and enter watermark text.');return}try{s.textContent='Adding watermark...';const{PDFDocument,rgb,StandardFonts}=PDFLib;const doc=await PDFDocument.load(await f.arrayBuffer());const font=await doc.embedFont(StandardFonts.Helvetica);const pages=doc.getPages();pages.forEach(p=>{const{width,height}=p.getSize();p.drawText(t,{x:60,y:height/2,font,size:50,color:rgb(0.5,0.5,0.5),opacity:0.5})});const b=await doc.save();d.href=URL.createObjectURL(new Blob([b],{type:'application/pdf'}));d.download=`watermarked-${f.name}`;d.classList.remove('hidden');s.textContent='Watermark added successfully!';showResetButton();}catch(e){s.textContent=`Error: ${e.message}`}})});