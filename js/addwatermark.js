document.addEventListener('DOMContentLoaded',()=>{document.getElementById('process-btn').addEventListener('click',()=>{const file=document.getElementById('file-input').files[0],text=document.getElementById('watermark-text').value,dl=document.getElementById('download-link'),size=document.getElementById('font-size').value,color=document.getElementById('font-color').value,opacity=document.getElementById('opacity').value,pos=document.getElementById('position').value;if(!file||!text){alert("Please select an image and enter text.");return}const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');c.width=img.width;c.height=img.height;const ctx=c.getContext('2d');ctx.drawImage(img,0,0);ctx.fillStyle=color;ctx.globalAlpha=opacity;ctx.font=`${size}px Arial`;let x,y;const margin=20;switch(pos){case'top-left':x=margin;y=parseInt(size)+margin;break;case'top-right':ctx.textAlign='right';x=c.width-margin;y=parseInt(size)+margin;break;case'bottom-left':ctx.textBaseline='bottom';x=margin;y=c.height-margin;break;case'bottom-right':ctx.textAlign='right';ctx.textBaseline='bottom';x=c.width-margin;y=c.height-margin;break;case'center':ctx.textAlign='center';ctx.textBaseline='middle';x=c.width/2;y=c.height/2;break}ctx.fillText(text,x,y);dl.href=c.toDataURL();dl.download=`watermarked-${file.name}`;dl.classList.remove('hidden');showResetButton()};img.src=e.target.result};reader.readAsDataURL(file)})});